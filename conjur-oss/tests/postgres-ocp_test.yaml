suite: Test Postgres manifests when Openshift enabled
templates:
  - "postgres-ocp.yaml"
tests:
  - it: should match snapshot of default values
    set:
      dataKey: "1234567890"
      openshift:
        enabled: true
    asserts:
      - matchSnapshot: {}
  - it: should not create the Postgres Openshift enabled manifests if 'openshift.enabled' is false
    set:
      dataKey: "1234567890"
      openshift:
        enabled: false
    asserts:
      - notExists:
          path: metadata.name      
  - it: should not mount a PVC if 'postgres.persistentVolume.create' is false
    set:
      dataKey: "1234567890"
      postgres:
        persistentVolume:
          create: false
      openshift:
        enabled: true          
    asserts:
      - notContains:
          path: spec.template.spec.containers[0].volumeMounts
          content: 
            name: postgres-data
          any: true
      - notContains:
          path: spec.template.spec.volumes
          content:
            name: postgres-data
  - it: should include resources if specified
    set:
      dataKey: "1234567890"
      postgres:
        resources:
          requests:
            cpu: "100m"
      openshift:
        enabled: true            
    template: "postgres-ocp.yaml"
    documentSelector:
      path: kind
      value: StatefulSet
    asserts:
      - equal:
          path: spec.template.spec.containers[0].resources.requests.cpu
          value: "100m"          